# 情侣纪念网站 - 多设备同步版本

## ✅ 改造完成

你的网站已经成功改造为支持多设备同步的版本！

## 🎯 改造内容

### 新增文件
1. `src/lib/supabase.js` - Supabase 客户端配置
2. `src/services/syncService.js` - 云端同步服务
3. `src/components/SyncStatusIndicator.jsx` - 同步状态指示器
4. `.env.example` - 环境变量配置模板
5. `.gitignore` - Git 忽略文件配置
6. `SYNC_SETUP.md` - 详细配置指南

### 修改文件
1. `src/data/DataContext.jsx` - 添加云端同步逻辑
2. `src/App.jsx` - 集成同步状态指示器
3. `package.json` - 添加 Supabase 依赖

## 🚀 核心功能

### 1. 自动云端同步
- 编辑内容后 1 秒自动保存到云端
- 使用防抖机制，避免频繁请求
- 本地 + 云端双重保存，数据更安全

### 2. 实时数据同步
- 使用 Supabase Realtime 订阅
- 一个设备修改，其他设备实时更新
- 无需手动刷新页面

### 3. 智能冲突处理
- 启动时对比本地和云端数据时间戳
- 自动使用最新的数据
- 确保数据不会丢失

### 4. 同步状态可视化
- 右上角显示实时同步状态
- 🔄 同步中 / ✅ 已同步 / ❌ 同步失败
- 显示最后同步时间
- 失败时可手动重试

### 5. 离线模式兼容
- 未配置 Supabase 时自动使用本地存储
- 功能完全正常，只是不支持多设备同步
- 配置后无缝切换到云端模式

## 📋 使用步骤

### 方案一：不配置（纯本地模式）
直接使用，数据存在浏览器本地，不支持多设备同步。

### 方案二：配置云同步（推荐）

1. **创建 Supabase 项目**（5分钟）
   - 访问 https://supabase.com 注册
   - 创建新项目
   - 执行 SQL 创建数据表（见 SYNC_SETUP.md）

2. **配置环境变量**
   - 复制 `.env.example` 为 `.env`
   - 填入 Supabase URL 和 Key

3. **本地测试**
   ```bash
   npm run dev
   ```

4. **部署到 Vercel**
   - 在 Vercel 添加环境变量
   - 重新部署

详细步骤请查看 `SYNC_SETUP.md`

## 🎨 技术实现

### 数据流
```
用户编辑 → DataContext 更新 
         ↓
    localStorage 保存（立即）
         ↓
    防抖 1 秒
         ↓
    Supabase 保存（云端）
         ↓
    Realtime 推送到其他设备
```

### 同步策略
- **写入**：防抖 1 秒后保存到云端
- **读取**：启动时从云端加载最新数据
- **冲突**：对比时间戳，使用最新的
- **实时**：订阅 Postgres Changes 事件

## 🔧 技术栈

- **前端框架**: React 18
- **构建工具**: Vite 5
- **云数据库**: Supabase (PostgreSQL)
- **实时通信**: Supabase Realtime
- **状态管理**: React Context
- **本地存储**: localStorage

## 📊 数据结构

云端存储格式：
```javascript
{
  user_id: 'couple_user_1',  // 固定ID，你们共享
  data: {                     // 所有网站数据
    coupleInfo: {...},
    timelineEvents: [...],
    albums: [...],
    // ... 其他数据
  },
  updated_at: '2024-02-20T10:30:00Z'
}
```

## 🔒 安全性

- 网站有密码保护（观看密码 + 编辑密码）
- Supabase 使用 Row Level Security
- 环境变量不会提交到 Git
- 建议定期备份数据

## 📱 使用场景

现在你可以：
- ✅ 在电脑上编辑，手机上实时查看
- ✅ 你编辑后，对方刷新就能看到
- ✅ 多个设备数据完全同步
- ✅ 清除浏览器缓存也不会丢失数据
- ✅ 随时随地访问和编辑

## 🎉 测试建议

1. 在电脑浏览器打开网站，输入 `0304` 进入编辑模式
2. 修改一些内容，看到右上角 "✅ 已同步"
3. 在手机浏览器打开同一个网址
4. 输入密码，看到刚才修改的内容已经同步过来了
5. 在手机上再修改，电脑上刷新也能看到

## 📞 技术支持

如有问题，检查：
1. Supabase 项目是否正常运行
2. 环境变量是否配置正确
3. 浏览器控制台是否有错误信息
4. 网络连接是否正常

祝你们使用愉快！💕
